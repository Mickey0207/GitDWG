# GitDWG - Git版本控制與AutoCAD圖面比較工具

這是一個結合Git版本控制系統和AutoCAD圖面比較功能的桌面應用程式，使用WinUI 3和.NET 8開發。

## ?? 最新更新

**全新啟動體驗**：現在首次使用時會自動引導您完成作者資訊設定，之後就不需要再重複輸入！

## 主要功能

### Git版本控制功能
- 選擇和初始化Git儲存庫
- 查看和管理分支
- 查看提交歷史
- 暫存和提交變更
- 建立新分支和切換分支
- 查看檔案狀態

### AutoCAD整合功能
- 自動檢測AutoCAD安裝路徑
- 手動設定AutoCAD路徑
- 開啟圖面檔案(.dwg/.dxf)
- 比較不同版本的圖面檔案

### 版本比較功能
- 選擇提交進行版本比較
- 自動篩選圖面檔案變更
- 快速開啟變更的圖面檔案

## 系統需求

- Windows 10版本1809 (建置17763) 或更新版本
- .NET 8 Runtime
- AutoCAD (可選，用於圖面比較功能)

## ?? 快速開始

### 第一次使用
1. **啟動應用程式**
2. **設定作者資訊**：
   - 在歡迎畫面輸入您的姓名和Email
   - 這些資訊將用於Git提交記錄
   - 只需設定一次，之後會自動記住
3. **開始使用**：設定完成後自動進入主畫面

### 後續使用
- 直接啟動，無需重複設定
- 如需修改作者資訊，點擊「用戶設定」按鈕

## 使用說明

### 初始設定
1. **自動引導**：首次啟動時會自動顯示設定畫面
2. **填寫資訊**：
   - 作者姓名（至少2個字元）
   - 作者Email（有效格式）
3. **完成設定**：點擊「確定」保存設定

### 基本Git操作
1. **選擇儲存庫**：點擊「選擇儲存庫」選擇專案資料夾
2. **初始化Git**：如果不是Git儲存庫，點擊「初始化儲存庫」
3. **查看狀態**：在「檔案狀態」區域查看變更
4. **暫存變更**：點擊「暫存所有」將變更加入暫存區
5. **提交變更**：
   - 輸入提交訊息
   - 點擊「提交」（作者資訊已自動填入）

### 分支管理
- **查看分支**：左側顯示所有分支
- **建立分支**：點擊「+」按鈕
- **切換分支**：直接點擊分支名稱

### DWG檔案特殊操作
1. **檢查狀態**：點擊「檢查CAD檔案」查看詳細狀態
2. **解決鎖定**：如果檔案被鎖定，關閉AutoCAD後點擊「強制重新整理」
3. **監控大小**：檔案狀態會顯示DWG檔案大小
4. **診斷問題**：點擊「診斷提交問題」獲得解決建議

### 版本比較
1. 在右側「提交歷史」中選擇一個提交
2. 點擊「比較選擇的提交」
3. 查看「變更的圖面檔案」區域
4. 點擊「開啟圖面」使用AutoCAD開啟檔案

## DWG檔案偵測問題故障排除

### 常見問題及解決方案

#### 問題1: Git偵測不到DWG檔案變更
**可能原因:**
- AutoCAD正在使用該檔案，導致檔案被鎖定
- .gitignore檔案排除了DWG檔案
- Git索引需要重新整理

**解決步驟:**
1. 關閉AutoCAD中正在編輯的DWG檔案
2. 點擊「強制重新整理」按鈕
3. 點擊「檢查CAD檔案」確認狀態
4. 如果問題持續，檢查.gitignore檔案

#### 問題2: 檔案顯示為「使用中」
**解決方法:**
1. 確保AutoCAD已完全關閉該檔案
2. 檢查是否有AutoCAD背景程序仍在運行
3. 等待幾秒鐘後點擊「強制重新整理」
4. 如果問題持續，重新啟動AutoCAD

#### 問題3: 無法提交「No changes; nothing to commit」
**解決方法:**
1. 點擊「診斷提交問題」查看詳細分析
2. 確認檔案已修改並已暫存
3. 點擊「暫存所有」確保變更已暫存
4. 檢查是否有檔案被鎖定

### 最佳實踐

#### DWG檔案工作流程編輯DWG → 關閉AutoCAD → 強制重新整理 → 暫存所有 → 提交
#### Git操作建議
1. **頻繁提交**: 在重要變更點提交
2. **描述性訊息**: 提交訊息應描述設計變更
3. **分支使用**: 為不同的設計方案使用不同分支
4. **備份策略**: 定期推送到遠端儲存庫

## 技術架構

### 使用的技術和套件
- **UI框架**: WinUI 3
- **開發平台**: .NET 8
- **Git整合**: LibGit2Sharp
- **MVVM模式**: 自訂RelayCommand和ViewModels
- **檔案操作**: System.IO和Windows.Storage
- **設定管理**: JSON序列化保存用戶設定

### 專案結構GitDWG/
├── Models/
│   └── CommitInfo.cs          # 提交資訊模型
├── Services/
│   ├── GitService.cs          # Git操作服務（增強DWG支援）
│   ├── AutoCadCompareService.cs # AutoCAD整合服務
│   └── UserSettingsService.cs   # 用戶設定服務
├── Views/
│   └── InitialSetupWindow.cs     # 初始設定窗口
├── ViewModels/
│   └── MainViewModel.cs       # 主視圖模型（簡化UI）
├── MainWindow.xaml            # 主視窗UI（移除作者輸入欄位）
├── MainWindow.xaml.cs         # 主視窗程式碼
├── App.xaml                   # 應用程式定義
└── App.xaml.cs               # 應用程式進入點（新增設定流程）
## 開發說明

### 建置專案dotnet restore
dotnet build
### 執行專案dotnet run
### 主要類別說明

**UserSettingsService**: 管理用戶設定，包括：
- 作者資訊保存和載入
- 設定檔案加密和驗證
- 自動偵測設定完整性

**InitialSetupWindow**: 初始設定窗口，包括：
- 引導新用戶設定作者資訊
- 即時輸入驗證
- 優雅的設定流程

**GitService**: 封裝LibGit2Sharp的Git操作，包括：
- 儲存庫初始化和驗證
- 分支管理
- 提交歷史查詢
- 檔案狀態和版本比較
- **DWG檔案特殊處理**: 檔案鎖定檢查、大小監控、智慧診斷

**MainViewModel**: 實作MVVM模式的主要視圖模型，處理：
- UI資料綁定
- 命令處理
- 業務邏輯協調
- **簡化的用戶界面**: 移除作者輸入，自動使用保存的設定

## 注意事項

1. **首次使用**: 必須完成初始設定才能使用Git功能
2. **作者資訊**: 設定會自動保存，可隨時在「用戶設定」中修改
3. **AutoCAD路徑**: 應用程式會自動嘗試檢測，如果檢測失敗需要手動設定
4. **檔案權限**: 確保應用程式對選擇的儲存庫資料夾有讀寫權限
5. **圖面格式**: 目前支援.dwg、.dxf、.dwt、.dws格式的圖面檔案
6. **檔案鎖定**: 編輯DWG檔案時，請完全關閉AutoCAD後再進行Git操作
7. **自動設定**: 應用程式會自動創建.gitignore和.gitattributes檔案以最佳化CAD工作流程

## 疑難排解快速指南

| 症狀 | 解決方法 |
|------|----------|
| Git偵測不到DWG變更 | 1. 關閉AutoCAD<br>2. 點擊「強制重新整理」 |
| 檔案顯示「使用中」 | 1. 確認AutoCAD已關閉檔案<br>2. 等待幾秒後重新整理 |
| 無法提交 | 1. 點擊「診斷提交問題」<br>2. 按照建議操作 |
| 需要修改作者資訊 | 點擊「用戶設定」按鈕 |
| 檔案大小異常 | 考慮使用Git LFS處理大型檔案 |

## ?? 使用技巧

### 新用戶建議
1. **完整設定**: 在初始設定時填寫真實的姓名和Email
2. **測試功能**: 先用小型專案測試各項功能
3. **學習工作流程**: 熟悉「編輯→關閉→重新整理→暫存→提交」的流程

### 高級使用者
1. **分支策略**: 為不同設計方案建立分支
2. **定期診斷**: 使用「診斷提交問題」功能預防問題
3. **效能監控**: 注意大型DWG檔案的處理效能

## 未來改進方向

- 支援更多Git操作（合併、重置等）
- 改進圖面比較功能
- 新增圖面預覽功能
- 支援多種CAD軟體
- 新增批次處理功能
- 改進使用者介面設計
- **Git LFS整合**: 自動處理大型DWG檔案
- **即時監控**: 監控檔案系統變更並自動重新整理
- **多用戶設定**: 支援多個作者設定檔案
- **雲端同步**: 設定檔案雲端同步功能

## 授權

此專案僅供學習和研究使用。