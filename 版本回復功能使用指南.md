# GitDWG 版本回復功能使用指南

## ?? 新功能發布
GitDWG現在支援完整的版本回復功能！參考Visual Studio的Git管理體驗，我們提供了專業級的版本控制操作界面。

## ?? 功能位置
在主界面右側的「版本操作」區域，您會看到以下功能：

### ?? 版本比較
- **功能**：比較選擇的提交與前一版本
- **操作**：選擇提交歷史中的任一版本，點擊「比較版本」按鈕
- **特點**：自動使用AutoCAD開啟兩個版本的圖面進行視覺化比較

### ??? 安全回復（推薦）
- **功能**：創建新提交來撤銷變更，保留歷史
- **操作**：選擇目標版本，點擊「安全回復」按鈕
- **特點**：
  - ? 保留所有提交歷史
  - ? 創建新的提交來撤銷變更
  - ? 可以再次回復（可逆操作）
  - ? 團隊協作安全

### ?? 重置版本（危險操作）
- **功能**：刪除後續提交歷史，回到指定版本
- **操作**：選擇目標版本，點擊「重置版本」按鈕
- **警告**：
  - ? 永久刪除指定版本之後的所有提交
  - ? 不可逆操作！
  - ? 可能影響團隊協作

## ?? 使用方式

### 步驟1: 選擇目標版本
1. 在右側「提交歷史」列表中瀏覽所有提交記錄
2. 點擊您想要回復的版本（會顯示在「已選擇版本」區域）
3. 確認選擇的版本資訊正確

### 步驟2: 選擇回復方式

#### ??? 安全回復（推薦使用）

**何時使用**：
- 99%的情況下都建議使用此選項
- 需要保留完整的提交歷史
- 團隊協作環境
- 不確定是否需要永久刪除歷史時

**操作流程**：
1. 點擊「安全回復」按鈕
2. 系統會檢查工作目錄狀態
3. 如有未提交變更，會顯示警告並建議先提交
4. 顯示詳細的確認對話框，包含：
   - ??? 安全回復操作說明
   - ?? 目標版本詳細資訊
   - ?? 當前儲存庫狀態
5. 確認後執行回復操作

**技術實現**：
- 使用 `git revert` 命令
- 創建新的提交來撤銷變更
- 保留完整的Git歷史

#### ?? 重置版本（謹慎使用）

**何時使用**：
- 僅在個人儲存庫且確定需要清理歷史時使用
- 確定要永久刪除後續提交
- 不會影響其他團隊成員的工作

**操作流程**：
1. 點擊「重置版本」按鈕
2. 第一層警告：詳細說明危險性和建議替代方案
3. 第二層確認：要求輸入確認文字「確認刪除提交歷史」
4. 執行重置操作

**技術實現**：
- 使用 `git reset --hard` 命令
- 永久刪除指定版本之後的提交
- 無法復原

## ?? 功能特色（參考Visual Studio設計）

### 智慧狀態檢測
- ?? 自動檢測工作目錄狀態
- ?? 提醒未提交的變更
- ?? 顯示詳細的檔案統計

### 多層確認機制
- ?? 危險操作多重警告
- ? 清晰的操作說明
- ?? 詳細的版本資訊展示

### 用戶友善界面
- ?? 直觀的視覺設計
- ?? 豐富的操作提示
- ?? 即時狀態回饋

### 專業級安全保護
- ??? 預設推薦安全操作
- ?? 危險操作明確標示
- ?? 操作前狀態檢查

## ?? 實際使用示例

### 示例1: 安全回復到昨天的版本場景：今天的修改有問題，想安全回復到昨天的版本

操作步驟：
1. 在提交歷史中找到昨天的提交
2. 點擊選擇該提交（會顯示在「已選擇版本」區域）
3. 點擊「安全回復」按鈕
4. 確認回復操作
5. GitDWG會創建新提交，檔案安全回復到昨天的狀態
6. 完整的提交歷史得到保留

結果：檔案內容回復，歷史完整，操作可逆
### 示例2: 比較兩個版本的圖面差異場景：想看看上週和這週的圖面有什麼不同

操作步驟：
1. 選擇這週的提交
2. 點擊「比較版本」按鈕
3. 系統會提取兩個版本的圖面檔案
4. AutoCAD會開啟兩個版本的圖面
5. 可以直接在AutoCAD中比較差異

結果：視覺化比較，清楚了解變更內容
### 示例3: 重置版本清理歷史（謹慎操作）場景：個人專案中有一些測試提交要永久清理

操作步驟：
1. 選擇要保留的最後一個提交
2. 點擊「重置版本」按鈕
3. 閱讀第一層危險警告
4. 選擇「我了解風險，繼續」
5. 在第二層確認中輸入「確認刪除提交歷史」
6. 執行重置操作

結果：後續提交被永久刪除，無法復原
## ?? 安全最佳實踐

### 回復前的準備工作
1. **檢查工作狀態**：確保沒有重要的未保存工作
2. **關閉AutoCAD**：避免檔案鎖定問題
3. **備份重要檔案**：雖然安全回復是可逆的，但備份總是好習慣
4. **通知團隊**：如果是共享儲存庫，提前通知團隊成員

### 選擇回復方式的建議
- ??? **99%的情況使用「安全回復」**
- ?? **僅在個人儲存庫且確定需要清理歷史時使用「重置版本」**
- ?? **絕不在共享團隊儲存庫中使用「重置版本」**
- ?? **不確定時，選擇安全回復**

### 團隊協作注意事項
- ?? 多人協作時避免使用重置功能
- ?? 版本回復操作前通知團隊
- ?? 優先使用分支進行實驗性修改
- ?? 定期備份重要的儲存庫

## ? 常見問題與解決

### 問題1: 回復後檔案沒有變化
**可能原因**：
- 選擇的版本與當前版本相同
- 檔案被其他程式鎖定

**解決方法**：
1. 檢查是否選擇了正確的歷史版本
2. 關閉AutoCAD等可能鎖定檔案的程式
3. 使用「強制重新整理」更新狀態
4. 確認提交歷史中的版本差異

### 問題2: 回復時提示有未提交變更
**原因**：工作目錄有未提交的修改

**解決方法**：
1. 使用「快速提交」先提交當前變更
2. 或者選擇「繼續執行」（可能會丟失變更）
3. 確保工作目錄乾淨後再執行回復

### 問題3: AutoCAD無法開啟比較檔案
**可能原因**：
- AutoCAD路徑未正確設定
- 檔案格式不相容
- 暫存檔案位置問題

**解決方法**：
1. 檢查並重新設定AutoCAD路徑
2. 確認檔案是有效的DWG格式
3. 檢查暫存目錄的存取權限
4. 嘗試手動開啟比較檔案

### 問題4: 意外使用了重置版本
**緊急恢復方法**：
如果剛執行完且還記得被刪除的提交SHA，可以嘗試：
# 查看操作記錄
git reflog

# 找到被刪除的提交並恢復
git reset --hard <commit-sha>
**預防措施**：
- 始終使用「安全回復」而非「重置版本」
- 操作前仔細閱讀確認對話框
- 定期備份重要儲存庫

## ?? 進階使用技巧

### 技巧1: 部分檔案回復
如果只想回復特定檔案而非整個版本：
1. 使用「比較版本」找到目標檔案
2. 手動從AutoCAD複製需要的內容
3. 作為新的提交保存變更

### 技巧2: 預覽回復效果
在確認回復前：
1. 使用「比較版本」預覽變更內容
2. 確認這就是想要的結果
3. 再執行實際回復操作

### 技巧3: 分支回復策略
對於重要的版本回復：
1. 在新分支上進行實驗性回復
2. 測試回復結果是否符合預期
3. 確認無誤後合併到主分支

### 技巧4: 批量版本分析
查看多個版本的變更：
1. 逐一選擇不同的提交
2. 使用「比較版本」分析每個變更點
3. 找出問題引入的確切版本

## ?? 功能對比表

| 功能 | 安全回復 | 重置版本 | 比較版本 |
|------|----------|----------|----------|
| **保留歷史** | ? 完全保留 | ? 部分刪除 | N/A |
| **可逆操作** | ? 完全可逆 | ? 不可逆 | N/A |
| **團隊安全** | ? 安全 | ? 危險 | ? 安全 |
| **操作複雜度** | ?? 簡單 | ?? 複雜 | ?? 簡單 |
| **風險等級** | ?? 低風險 | ?? 高風險 | ?? 無風險 |
| **執行速度** | ?? 一般 | ?? 快速 | ?? 快速 |
| **推薦使用** | ? 強烈推薦 | ?? 謹慎使用 | ? 推薦 |

## ?? 與其他功能的整合

### 與圖面比較功能整合
- 回復前使用比較功能預覽變更
- 回復後比較回復前後的差異
- 確保回復結果符合預期

### 與快速提交功能整合
- 回復操作會自動創建新的提交（安全回復模式）
- 回復後的狀態會顯示在提交歷史中
- 可以為回復提交添加描述性訊息

### 與分支管理功能整合
- 回復操作會影響當前分支
- 可以在專用分支上進行實驗性回復
- 支援跨分支的版本比較

### 與用戶管理功能整合
- 回復提交會使用當前用戶的身份
- 記錄詳細的操作歷史
- 支援多用戶環境的協作

## ?? 版本功能更新記錄

### v1.3.0 - 完整版本回復功能
- ? 新增安全回復功能
- ? 新增重置版本功能（帶安全警告）
- ? 改善版本比較體驗
- ? 參考Visual Studio的UI設計
- ? 多層確認機制
- ? 智慧狀態檢測

### 未來計劃功能
- ?? 分支間版本回復
- ?? 視覺化變更統計
- ?? 高級檔案搜尋
- ?? 回復操作註釋

---

**新功能狀態**：? 已完成並可使用  
**安全等級**：??? 高（安全回復模式）  
**建議使用場景**：CAD圖面版本管理、錯誤修改回復、歷史版本恢復  
**參考設計**：Visual Studio Git管理界面  

---

*GitDWG v1.3.0 - 讓CAD版本控制變得簡單而安全* ??